DROP TABLE IF EXISTS events_comp, requests, locations, compilations, events, comments, users, categories;

CREATE TABLE IF NOT EXISTS users (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	email VARCHAR(128) UNIQUE,
	name VARCHAR(128),
	CONSTRAINT pk_user PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS categories (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	name VARCHAR(128) UNIQUE,
	CONSTRAINT pk_categories PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS locations (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	event_id BIGINT,
	lat FLOAT,
	lon FLOAT,
	CONSTRAINT pk_locations PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS comments (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	event_id BIGINT,
	text TEXT,
	author_name VARCHAR(128),
	created TIMESTAMP WITH TIME ZONE,
	CONSTRAINT pk_comment PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS events (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	annotation VARCHAR(512),
	category_id BIGINT REFERENCES categories (id),
	confirmed_requests INT,
	created_on TIMESTAMP WITH TIME ZONE,
	description TEXT,
	event_date TIMESTAMP WITH TIME ZONE,
	initiator BIGINT REFERENCES users (id) ON DELETE CASCADE,
    location_id BIGINT REFERENCES locations (id),
    paid BOOLEAN,
    participant_limit INT,
    published_on TIMESTAMP WITH TIME ZONE,
    request_moderation BOOLEAN,
    state VARCHAR(20),
    title VARCHAR(128),
    views BIGINT,
    comment_id BIGINT REFERENCES comments (id) ON DELETE CASCADE,
	CONSTRAINT pk_events PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS compilations (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	pinned BOOLEAN,
	title VARCHAR(128),
	CONSTRAINT pk_compilations PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS events_comp (
	comp_id BIGINT REFERENCES compilations (id) ON DELETE CASCADE,
	event_id BIGINT REFERENCES events (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS requests (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	created TIMESTAMP WITH TIME ZONE,
	event_id BIGINT REFERENCES events (id) ON DELETE CASCADE,
	requester BIGINT REFERENCES users (id) ON DELETE CASCADE,
	status VARCHAR(20),
	CONSTRAINT pk_requests PRIMARY KEY (id)
);